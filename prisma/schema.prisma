
/*
** Prisma Schema for a simple small ecommerce store
*/

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}


model Product {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  name String
  slug String? @unique
  description String?
  colors String[]    // e.g., “yellow gold”, “rose gold”, “white gold”, “silver”
  images  String[]  // Array of image URLs
  imagesByColors Json?
  sizes  String[]   // ring size or chain length (e.g., “6”, “18 inch”)
  gender GENDER?
  price Float
  stock Int
  material String?        // e.g., “gold”, “silver”, “platinum”
  metalPurity String?     // e.g., “18K”, “22K”, “925 Sterling”
  stoneType String?       // e.g., “diamond”, “sapphire”, “emerald”
  stoneShape String?      // e.g., “round”, “princess”, “oval”
  stoneWeight String?     // e.g., “0.5 carat”
  weight Float?           // total jewelry weight (grams)
  occasion String?        // e.g., “engagement”, “wedding”, “birthday”, “anniversary”
  collectionTags String?  // Useful for tagging collections (e.g., “new-arrivals”, “bestsellers”)
  isFeatured Boolean?     // for homepage highlights
  dimensions  String?
  discount  Float?

  shippingInfo String?


  categoryId String @db.ObjectId
  category Category @relation(fields: [categoryId], references: [id])

  orderItems OrderItem[]
  carts Cart[] // One product can have multiple cart entries
  
  reviews Review[]


  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}


model Category {
  id  String @id  @default(auto())  @map("_id") @db.ObjectId
  name  String

  products Product[]
 
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}


model User {
  id  String  @id @default(auto())  @map("_id") @db.ObjectId
  name String 
  email String  @unique
  image String?
  
  role Role @default(CUSTOMER) 

  reviews Review[]
  wishlist String[] @db.ObjectId // Array of product IDs

  addresses Address[]
  orders Order[]
  carts Cart[] // One user can have multiple cart entries

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Order {
  id  String  @id @default(auto())  @map("_id") @db.ObjectId
  orderNumber String  @unique

  items OrderItem[]

  userId String @db.ObjectId
  user User @relation(fields: [userId], references: [id])

  shippingAddressId String?  @db.ObjectId
  shippingAddress Address?  @relation(fields: [shippingAddressId], references: [id])

  total Float
  tax Float?
  shippingCost  Float?
  paymentStatus PaymentStatus @default(PENDING)
  status OrderStatus  @default(PROCESSING)
  trackingNumber  String?
  carrier String?
  
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model OrderItem {
  id  String  @id  @default(auto()) @map("_id") @db.ObjectId

  orderId String  @db.ObjectId
  order Order @relation(fields: [orderId], references: [id])

  productId String  @db.ObjectId
  product Product @relation(fields: [productId], references: [id])

  quantity Int
  priceAtPurchase Float // This is the price the product has been purchased by it in the past
}

model Address {
  id  String  @id @default(auto()) @map("_id") @db.ObjectId
  street String
  city  String
  State String
  zipCode String
  Country String
  
  // If the User had multiple addresses
  userId String @db.ObjectId
  user User @relation(fields: [userId], references: [id])

  
  orders Order[] // For example all orders of the same user may shipped to this address

  isDefault Boolean @default(false)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

}

model Cart {
  id  String  @id @default(auto()) @map("_id")  @db.ObjectId

  productId String @db.ObjectId
  products Product @relation(fields: [productId], references: [id])

  userId String @db.ObjectId
  user User @relation(fields: [userId], references: [id])

  quantity Int  @default(1)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([userId, productId]) // Prevents duplicate products in same user's cart
}

model Review {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  rating  Int
  comment String?

  userId  String  @db.ObjectId
  user  User  @relation(fields: [userId], references: [id])

  productId String  @db.ObjectId
  product Product @relation(fields: [productId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([userId, productId])
}



// Enums...
enum Role {
  ADMIN
  CUSTOMER
}
enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
  CANCELLED
}
enum OrderStatus {
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  RETURNED
}
enum GENDER {
  MEN
  WOMEN
  UNISEX
}